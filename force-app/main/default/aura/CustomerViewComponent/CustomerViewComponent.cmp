<aura:component implements="flexipage:availableForAllPageTypes,force:appHostable,force:lightningQuickAction,force:hasRecordId" access="global" controller="CustomerViewComponentCtlr">
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:attribute name="recordId" type="String" /> 
    <aura:attribute name="accountObj" type="Object" />         
    <aura:attribute name="conObj" type="Object" /> 
    <aura:attribute name="oppObj" type="Object" /> 
    <aura:attribute name="lawyerObj" type="Object" /> 
    <aura:attribute name="oppList" type="Opportunity[]" />  
    <aura:attribute name="spinner" type="boolean" default="false" />
    <aura:attribute name="amendmentList" type="Amendment__c[]" />
    <aura:attribute name="contactsHistory" type="Contact[]" />
    <aura:attribute name="firmHistory" type="Firm__c[]" />
    <aura:attribute name="TransactionItems" type="Object[]" />
    <aura:attribute name="OpportunityTransactions" type="Object[]" />
    <aura:attribute name="LoanSummary" type="Object" />
    <aura:attribute name="calendarMin" type="date" />
    <aura:attribute name="calendarMax" type="date" />    
    <aura:attribute name="clickSource" type="String" default="none" /> 
    <aura:attribute name="selectedLookUpLawFirm" type="sObject" default="{}"/>
    <aura:attribute name="selectedLookUpLawyer" type="sObject" default="{}"/>
    <aura:attribute name="selectedLookUpAccOwner" type="sObject" default="{}"/>
    <aura:attribute name="note" type="ContentNote" default="{'sobjectType': 'ContentNote','Title': 'N/A','Content': ''}"/>
    <aura:attribute name="noteContent" type="String" default="" />
    <aura:attribute name="showNotePopup" type="boolean" default="false" />
    <aura:attribute name="selectedNoteId" type="String" default="" />
    <aura:attribute name="criticalDateList" type="Critical_Date__c[]" />
    <aura:attribute name="criticalDateName" type="List" default="[]"/>
    <aura:attribute name="oppIdList" type="Id[]" />
    
    
    <aura:attribute name="notes" type="Object[]" />
    <aura:attribute name="paymentActionsMap" type="Map" default="{}"/>
    <aura:attribute name="paymentActionsValidationMap" type="Map" default="{}"/>
    <aura:attribute name="displayPaymentValidationErrors" type="Boolean" default="false" />
    
    <aura:handler name="change" value="{!v.conObj.Phone}" action="{!c.formatPhone}" />
    <aura:handler name="change" value="{!v.conObj.OtherPhone}" action="{!c.formatOtherPhone}" />
    <aura:handler name="change" value="{!v.oppObj.Lawyer__r.Phone}" action="{!c.formatLawPhone}" />
    <aura:handler event="aura:locationChange" action="{!c.onLocationChange}"/>

    
    <aura:attribute name="paymentSearchTypeSelected" type="String" /> 
    <aura:attribute name="paymentPayoutSearch" type="boolean" /> 
    <aura:attribute name="paymentMiscSearch" type="boolean" /> 
	<aura:attribute name="paymentRefundSearch" type="boolean" />     
    <aura:attribute name="paymentDate" type="date" /> 
    <aura:attribute name="paymentAmount" type="decimal" /> 
    <aura:attribute name="calculatedPaymentAmount" type="decimal" />     
	<aura:attribute name="estimatedTotalBalance" type="decimal" />    
    <aura:attribute name="EFT" type="decimal" /> 
    <aura:attribute name="CHQ" type="decimal" /> 
    <aura:attribute name="paymentsError" type="String" /> 
    <aura:attribute name="paymentSearchDisabled" type="Boolean" /> 
    
    <aura:attribute name="fieldLabels" type="Map" />
    <aura:attribute name="pickListMap" type="Map" />  
    <aura:attribute name="applicantInfoEditMode" type="boolean" default="false" />
    <aura:attribute name="payoutDateSet" type="boolean" default="false" />

    <aura:attribute name ="createButtonDisabled" type="Boolean" default="{!false}" />
    
    <!-- FETCHING PICKLIST VALUES -->   
    <aura:attribute name="businessUnitOptions" type="List" default="[]"/>
    <aura:attribute name="accountTypeOptions" type="List" default="[]"/>
    <aura:attribute name="provinceResidencyOptions" type="List" default="[]"/>
    <aura:attribute name="elfiBuyoutLoanOptions" type="List" default="[]"/>
    <aura:attribute name="citizenshipStatusOptions" type="List" default="[]"/>
    <aura:attribute name="meritalStatusOptions" type="List" default="[]"/>
    <aura:attribute name="spousalChildSupportPmtOptions" type="List" default="[]"/>
    <aura:attribute name="howBeenArrearsOnPmtOptions" type="List" default="[]"/>
    <aura:attribute name="haveAnyDependantsOptions" type="List" default="[]"/>
    <aura:attribute name="everDeclaredBankcrupcyOptions" type="List" default="[]"/>
    <aura:attribute name="employmentStatusTimeofAccidentOptions" type="List" default="[]"/>
    <aura:attribute name="existingLitigationLoanOptions" type="List" default="[]"/>
    
    <!-- Transaction total -->
    <aura:attribute name="paymentAmountTotal" type="Double" default="0.0"/>
    <aura:attribute name="advanceTotal" type="Double" default="0.0"/>
    <aura:attribute name="accruedInterestTotal" type="Double" default="0.0"/>
    <aura:attribute name="outstandingBalanceTotal" type="Double" default="0.0"/>
    <aura:attribute name="perDiemTotal" type="Double" default="0.0"/>
    
    <aura:attribute name="approvalHistory" type="List" default="[]"/>
    <aura:attribute name="ReasonForLTV" type="List" default="[{'label': 'Business Development', 'value': 'Business Development'},
    {'label': 'Lawyer Relationship', 'value': 'Lawyer Relationship'},{'label': 'Assessment Loan', 'value': 'Assessment Loan'}]"/>
    <aura:attribute name="selectedReasonForLTV" type="String" default="" />
    
    <!--
    <aura:attribute name="businessUnitOptions" type="List" default="[
    {'label': 'ELFI', 'value': 'ELFI'},
    {'label': 'Rhino', 'value': 'Rhino'},
    ]"/> 

    <aura:attribute name="accountTypeOptions" type="List" default="[
    {'label': 'Client', 'value': 'Client'},
    ]"/>       
    
    <aura:attribute name="provinceResidencyOptions" type="List" default="[
    {'label': 'Alberta', 'value': 'Alberta'},
{'label': 'British Columbia', 'value': 'British Columbia'},
{'label': 'Ontario', 'value': 'Ontario'},
{'label': 'Manitoba', 'value': 'Manitoba'},
{'label': 'New Brunswick', 'value': 'New Brunswick'},
{'label': 'Newfoundland &#x26; Labrador', 'value': 'Newfoundland &#x26; Labrador'},
{'label': 'Northwest Territories', 'value': 'Northwest Territories'},
{'label': 'Nova Scotia', 'value': 'Nova Scotia'},
{'label': 'Nunavut', 'value': 'Nunavut'},
{'label': 'Prince Edward Island', 'value': 'Prince Edward Island'},                                                                         
{'label': 'Quebec', 'value': 'Quebec'},
{'label': 'Saskatchewan', 'value': 'Saskatchewan'},
{'label': 'Yukon Territory', 'value': 'Yukon Territory'},                                                                         
    ]"/>  
    
    <aura:attribute name="elfiBuyoutLoanOptions" type="List" default="[
    {'label': 'Yes', 'value': 'Yes'},
    {'label': 'No', 'value': 'No'},
    ]"/>   --> 
    
    <!-- PRIVATE ATTRIBUTES -->
    <aura:attribute name="_enableCloseAllPaid" type="Boolean" default="{!false}" description="if true, it enables the close all paid button on the loan overview page." />
    <aura:attribute name="_renderTable" type="Boolean" default="{!false}" description="if true, shows the table or false otherwise." />
    <aura:attribute name="_columns" type="List" description="List of columns for a table." />
    <aura:attribute name="_selectedTabId" type="String" default="ACCOUNT" />
    <aura:attribute name="_selectedSecondaryTabId" type="String" default="" />
    <!-- PRIVATE ATTRIBUTES -->
    
    <aura:attribute name="paymentsSearchTypes" type="List" default="[
                                                                    {'label': 'Payout', 'value': 'Payout'},
                                                                    {'label': 'Misc Income Payment', 'value': 'Misc Income Payment'},
                                                                    {'label': 'Refund', 'value': 'Refund'},
                                                                    ]"/>    
    
    <aura:attribute name="currentUser" type="User" /> 
    
    <lightning:overlayLibrary aura:id="overlayLib"/>
    <body> 
        <!-- <<<<<<<<<< PAGE HEADER, TITLE AND BUTTONS >>>>>>>>>> -->
        <div class="slds-page-header">
            <div class="slds-media">
                <div class="slds-media__figure">
                    <lightning:icon iconName="standard:user" size="medium"/>
                </div>
                <div class="slds-media__body">
                    <p class="slds-text-body_small slds-line-height_reset">ACCOUNT</p>
                    <h1 class="slds-page-header__title slds-truncate slds-align-middle" title="{!v.accountObj.Name}">{!v.accountObj.Name}</h1>                
                </div>
                <lightning:buttonGroup>                    
                    <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Standard View" onclick="{!c.redirectToStandardView}" />                    
                    <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Contact Sheet" onclick="{!c.showPrintableView}" />
                  	<lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Send Application Document" onclick="{!c.sendApplicationDocument}" />
                    <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="PDF Application Document" onclick="{!c.pdfApplicationDocument}" />
                </lightning:buttonGroup>
            </div>
        </div>     
        
        <lightning:tabset aura:id="primaryTabs" selectedTabId="{!v._selectedTabId}" onselect="{!c.onPrimaryTabSelect}" variant="default">
            <lightning:tab id="ACCOUNT" label="ACCOUNT" onactive="{!c.onfocusAccountTab}">
                
                <!-- <<<<<<<<<< ACCOUNT INFORMATION >>>>>>>>>> -->
                <lightning:card title="Account Information" iconName="standard:case" variant="base">
                    <aura:set attribute="actions">
                        <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Save" onclick="{!c.saveAll}" />
                        <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Cancel" onclick="{!c.doCancel}" />                        
                        <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Delete" onclick="{!c.doDelete}" />    
                        <!--
                        <lightning:button class="slds-theme_neutral buttonWidth" variant="neutral" type="button" label="Generate Replacement Counsel Documents (PDF)" onclick="{!c.generateReplacementCounselDocuments}" />
                        <lightning:button class="slds-theme_neutral buttonWidth" variant="neutral" type="button" label="Send Replacement Counsel Documents" onclick="{!c.sendReplacementCounselDocuments}" />     
                        -->
                    </aura:set>
                    
                    <div class="slds-card__body_inner">                       
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.ELF_File_No__c}" tabindex="1" label="File No" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">                                            
                                            <span class="slds-form-element__static">
                                                <aura:if isTrue="{!notequals(v.clickSource , 'AccountOwner')}">
                                                    <!-- Show only related record name -->
                                                    <ui:inputText class="field" value="{!v.selectedLookUpAccOwner.Name}" disabled="true" label="Account Owner" />
                                                    
                                                    <!-- Show lookup option to change related record -->
                                                    <aura:set attribute="else">                                    
                                                        <c:customLookup objectAPIName="User" 
                                                                        IconName="standard:user" 
                                                                        label="Account Owner" 
                                                                        hideLookupInputAction="{!c.hideLookupInput}"
                                                                        selectedRecord="{!v.selectedLookUpAccOwner}"
                                                                        additionalFields = "Title,Phone,Email" 
                                                                        additionalDisplayFields = "Title,Phone,Email" />
                                                    </aura:set>                                                    
                                                </aura:if>                                         
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem>
                                <div class="slds-form-element"><span class="slds-form-element__label"></span>
                                    <div class="slds-form-element__control">
                                        <aura:if isTrue="{!notequals(v.clickSource , 'AccountOwner')}">
                                            <button data-source ="AccountOwner" onclick="{!c.inlineEditName}" 
                                                    class="slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small slds-m-top_small" 
                                                    tabindex="0" title="Edit Owner">
                                                <lightning:icon iconName="utility:search" size="xx-small" alternativeText="search" tabindex="4" />
                                            </button>
                                        </aura:if>
                                    </div>
                                </div>
                            </lightning:layoutItem>                            
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label"></span>
                                    <div class="slds-form-element__control">
                                        
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>
                        
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:combobox label="Business Unit" name="BusinessUnit" value="{!v.accountObj.Business_Unit__c}" 
                                                                placeholder="--None--" options="{! v.businessUnitOptions }" tabindex="2" required="true" />                                                      
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                            </lightning:layoutItem>
                        </lightning:layout>
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:combobox label="Account Type" name="AccountType" value="{!v.accountObj.Account_Type__c}" 
                                                                placeholder="--None--" options="{! v.accountTypeOptions }" tabindex="3" />                                                      
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.accountObj.How_did_you_hear_about_us__c}" label="How did you hear about us" tabindex="5" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>                        
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.accountObj.Web_to_Lead_From__c}" label="Web to Lead From" tabindex="6" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>                        
                    </div>
                </lightning:card>
                
                <!-- <<<<<<<<<< CONTACT INFORMATION >>>>>>>>>> -->
                <lightning:card title="Contact Information" iconName="standard:case" variant="base">                    
                    <div class="slds-card__body_inner">                       
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.accountObj.Name}" label="Account Name" tabindex="7" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.MailingStreet}" label="Address" tabindex="14" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>   
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.If_yes_please_provide_previous_name__c}" label="Previous Name" tabindex="8" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" >
                                    <div class="slds-form-element__control" style="margin-top:-20px;">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.MailingCity}" tabindex="15" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout> 
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.MiddleName}" label="Middle Name" tabindex="9" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" >
                                    <div class="slds-form-element__control" style="margin-top:-45px;">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.MailingState}" tabindex="16" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>  
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.LastName}" label="Last Name" tabindex="10" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" >
                                    <div class="slds-form-element__control" style="margin-top:-70px;">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.MailingPostalCode}" tabindex="17" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout> 
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:input class="field" value="{!v.conObj.Phone}" label="Mobile Phone" tabindex="11" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" style="margin-top:-70px;">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:combobox label="Province of Residency" name="ProvinceResidency" value="{!v.accountObj.ProvinceResidency__c}" 
                                                                placeholder="--None--" options="{! v.provinceResidencyOptions }" tabindex="18" />                                                      
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">                                
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control"><span class=""> <lightning:input class="field" value="{!v.conObj.OtherPhone}" label="Alternate Phone" tabindex="12" /></span></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control"><span class=""> <lightning:input class="field" value="{!v.conObj.Email}" label="Email" tabindex="12" /></span></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control"><span class=""> <lightning:input class="field" value="{!v.conObj.Secondary_Contact_Information__c}" label="Secondary Contact Information" tabindex="13" /></span></div>
                                        </div>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-m-bottom_small slds-m-left_xx-large date-in-table" style="margin-top:-50px;">                                    
                                        <lightning:card title="Critical Dates" iconName="standard:case" variant="base" >
                                            <aura:set attribute="actions">                                
                                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Add New" onclick="{!c.addNewCriticalDate}" />
                                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Save" onclick="{!c.saveCriticalDates}" />
                                            </aura:set>
                                            <table class="slds-table slds-table_bordered slds-table_col-bordered">
                                                <thead>
                                                    <tr class="slds-text-title_caps">
                                                        <th class="slds-cell-buffer_left slds-cell-buffer_right" style="width:45%">
                                                            <div class="slds-truncate" title="Name">Name</div>
                                                        </th>
                                                        <th class="slds-cell-buffer_left slds-cell-buffer_right" style="width:45%">
                                                            <div class="slds-truncate" title="Date">Date</div>
                                                        </th>
                                                        <th style="width:10%" ></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <aura:iteration items="{!v.criticalDateList}" var="item" indexVar="i">
                                                        <tr class="slds-hint-parent">                                                    
                                                            <td class="slds-cell-buffer_left slds-cell-buffer_right" >
                                                                <div style="margin-top:-20px;">
                                                                    <lightning:select name="controllerFld"
                                                                                      value="{!item.Name__c}" aura:id="fieldId" required="true">
                                                                        <aura:iteration items="{!v.criticalDateName}" var="val">
                                                                            <option value="{!val.value}" selected="{!val.value == item.Name__c}">{!val.label}</option>
                                                                        </aura:iteration>
                                                                    </lightning:select>
                                                                </div>
                                                                <span data-index="{!i}"></span>
                                                            </td>
                                                            <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                                <lightning:input aura:id="fieldId" required="true" type="date" value="{!item.Date__c}" min="{! v.calendarMin}" max="{! v.calendarMax}" style="margin-top:-20px;"/>
                                                            </td>
                                                            <td class="">                            
                                                                <form class="criticalDate-form" onsubmit="{!c.deleteCriticalDateItem}">
                                                                    <input type="hidden" value="{!i}" class="criticalDate-item-index"/>
                                                                    <lightning:buttonIcon iconName="utility:delete" variant="bare" onclick="{! c.deleteCriticalDateItem}" alternativeText="Delete" />
                                                                </form>                                 
                                                            </td>
                                                        </tr>
                                                    </aura:iteration>                                    
                                                </tbody>
                                            </table>
                                        </lightning:card>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>    
                    </div>
                </lightning:card>
                
                <!-- <<<<<<<<<< FIRM INFORMATION >>>>>>>>>> -->
                <lightning:card title="Firm Information" iconName="standard:case" variant="base">                    
                    <div class="slds-card__body_inner">     
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            
                                            
                                            
                                            <aura:if isTrue="{!notequals(v.clickSource , 'Law_Firm__c')}">
                                                <span class="slds-form-element__static">
                                                    <!--<ui:inputText class="field" value="{!v.oppObj.Law_Firm__r.Name}" disabled="true" />-->
                                                    <lightning:input class="field" value="{!v.selectedLookUpLawFirm.Name}" disabled="true" tabindex="19" label="Law Firm" /><br />
                                                </span>
                                                <aura:set attribute="else">                                        
                                                    <section class="slds-popover slds-popover_edit" style="position:absolute;top: 0px" > 
                                                        <c:customLookup objectAPIName="Account" 
                                                                        IconName="standard:account" 
                                                                        hideLookupInputAction="{!c.hideLookupInput}"
                                                                        label="Law Firm" 
                                                                        selectedRecord="{!v.selectedLookUpLawFirm}"
                                                                        filter="RecordType.Name='Law Firm' "
                                                                        additionalFields="BillingCity,BillingState"
                                                                        additionalDisplayFields="BillingCity,BillingState"/>
                                                    </section>
                                                </aura:set>  
                                            </aura:if>
                                            
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem>
                                <div class="slds-form-element"><span class="slds-form-element__label"></span>
                                    <div class="slds-form-element__control">
                                        <aura:if isTrue="{!notequals(v.clickSource , 'Law_Firm__c')}">
                                            <button data-source ="Law_Firm__c" onclick="{!c.inlineEditName}" 
                                                    class="slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small slds-m-top_small" 
                                                    tabindex="19" title="Edit Law Firm">
                                                <lightning:icon iconName="utility:search" size="xx-small" alternativeText="edit"/>
                                            </button>
                                        </aura:if>
                                    </div>
                                </div>
                            </lightning:layoutItem>                             
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Address</span>
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <ui:outputText value="{!v.lawyerObj.MailingStreet}" /><br/>
                                            <ui:outputText class="field" value="{!v.lawyerObj.MailingCity}" /><br/>
                                            <ui:outputText class="field" value="{!v.lawyerObj.MailingState}" /><br/>  
                                            <ui:outputText class="field" value="{!v.lawyerObj.MailingPostalCode}" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>    
                        <div style="margin-top:-40px;">
                            <lightning:layout class="slds-m-left_xx-large">
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Lawyer</span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <aura:if isTrue="{!notequals(v.clickSource , 'Lawyer__c')}">
                                                    <span class="slds-form-element__static">
                                                        <ui:inputText class="field" value="{!v.selectedLookUpLawyer.Name}" disabled="true" />
                                                    </span>
                                                    <aura:set attribute="else">                                        
                                                        <section class="slds-popover slds-popover_edit" style="position:absolute;top: 0px" > 
                                              
                                                            <c:customLookup objectAPIName="Contact" 
                                                                            IconName="standard:contact" 
                                                                            hideLookupInputAction="{!c.hideLookupInput}"
                                                                            label="Lawyer Name" 
                                                                            selectedRecord="{!v.selectedLookUpLawyer}"
                                                                            fieldtoSearchIn = "Name_Formula__c"
                                                                            filter="{!'AccountId = \'' + v.selectedLookUpLawFirm.Id + '\'' }"
                                                                            additionalFields = "MailingCity,MailingState,MailingPostalCode,Province_fm__c" 
                                                                            additionalDisplayFields = "MailingCity,MailingState"/>
                                                        </section>
                                                    </aura:set>
                                                </aura:if>                                          
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem>
                                    <div class="slds-form-element"><span class="slds-form-element__label"></span>
                                        <div class="slds-form-element__control">
                                            <aura:if isTrue="{!notequals(v.clickSource , 'Lawyer__c')}">
                                                <button data-source ="Lawyer__c" onclick="{!c.inlineEditName}" 
                                                        class="slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small slds-m-top_small" 
                                                        tabindex="20" title="Edit Lawyer">
                                                    <lightning:icon iconName="utility:search" size="xx-small" alternativeText="edit" tabindex="20" />
                                                </button>
                                            </aura:if>
                                        </div>
                                    </div>
                                </lightning:layoutItem>                            
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label"></span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>
                        </div>
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Phone</span>
                                    <div class="slds-form-element__control"><span class=""><ui:inputText class="field" value="{!v.oppObj.Lawyer__r.Phone}" disabled="true" /></span></div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" style="margin-top:-35px;"><span class="slds-form-element__label"></span>
                                    <div class="slds-form-element__control"><span class=""></span></div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout> 
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Email</span>
                                    <div class="slds-form-element__control"><span class=""><ui:inputText class="field" value="{!v.oppObj.Lawyer__r.Email}" disabled="true" /></span></div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" style="margin-top:-70px;"><span class="slds-form-element__label"></span>
                                    <div class="slds-form-element__control"><span class=""></span></div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>                         
                    </div>
                </lightning:card>
                
                <!-- <<<<<<<<<< Funding Details >>>>>>>>>> -->
                <div class="slds-grid slds-wrap " style="height: 100%;">
                    <div class="slds-col">
                        <lightning:card title="Funding Details" iconName="standard:case" variant="base">                    
                            <div class="slds-card__body_inner">     
                                <lightning:layout class="slds-m-left_xx-large">
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Total Amount Loaned</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputCurrency class="field" value="{!v.accountObj.Total_Amount_Loaned__c}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="5" class="slds-m-left_xx-large">
                                        <lightning:input type="number" name="input7" label="Projected Loan Value" value="{!v.accountObj.Projected_Loan_Value__c}" formatter="currency" step="0.01" onchange="{!c.projectedLoanValueChanged}"/>
                                    </lightning:layoutItem>
                                </lightning:layout>
                                <!--<lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Existing Loan with another Lender</span>
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <ui:inputText class="field" value="{!v.oppObj.Existing_Litigation_Loans__c}" disabled="true" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                            </lightning:layoutItem>
                        </lightning:layout>
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Name of Lender</span>
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <ui:inputText class="field" value="{!v.oppObj.Name_of_Lender__c}" disabled="true" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                            </lightning:layoutItem>
                        </lightning:layout> 
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Amount</span>
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <ui:inputCurrency class="field" value="{!v.oppObj.Pre_Existing_Loan_Amount__c}" disabled="true" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                            </lightning:layoutItem>
                        </lightning:layout>
                        <div style="margin-top:-20px;">
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label"></span>
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <lightning:combobox label="Did ELF buyout the Loan?" name="ELFBuyoutLoan" value="{!v.oppObj.Did_ELF_buyout_the_Loan__c}" 
                                                                placeholder="-None-" options="{! v.elfiBuyoutLoanOptions }" tabindex="21" />                                                      
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                            </lightning:layoutItem>
                        </lightning:layout>

                        </div>
-->
                                <lightning:layout class="slds-m-left_xx-large">
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Date of Accident / Incident</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputDate class="field" value="{!v.oppObj.Date_of_Loss__c}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Loan To Value</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:formattedNumber value="{!v.accountObj.Loan_To_Value__c}" style="percent-fixed" maximumFractionDigits="2" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>
                                <div style="margin-top:-20px;">
                                    <lightning:layout class="slds-m-left_xx-large">
                                        <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                            <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label"></span>
                                                <div class="slds-form-element__control">
                                                    <span class="">
                                                        <lightning:combobox label="Accident Location" name="AccidentLocation" value="{!v.oppObj.Accident_Location_from_W2L__c}" 
                                                                            placeholder="--None--" options="{! v.provinceResidencyOptions }" tabindex="22" disabled="{!if(v.oppObj.Id == null,true,false)}" />                                                                                                                                              
                                                    </span>
                                                </div>
                                            </div>
                                        </lightning:layoutItem>
                                        <lightning:layoutItem size="5" class="slds-m-left_xx-large">
                                            <lightning:card title="Reason:" variant="base">
                                                <lightning:layout class="">
                                                    <lightning:layoutItem size="12" class="slds-m-left_xx-large">
                                                        <lightning:radioGroup aura:id="reasonForLTVRadioGroup"
                                                                              name="radioGroup"
                                                                              variant="label-hidden"
                                                                              label=""
                                                                              class="customRadioCls"
                                                                              options="{! v.ReasonForLTV }"
                                                                              value="{! v.selectedReasonForLTV}"
                                                                              type="radio"/>
                                                    </lightning:layoutItem>
                                                </lightning:layout>
                                            </lightning:card>
                                            <lightning:card title="Approvals:" iconName="standard:approval" variant="base">
                                                <div style="max-height:200px;overflow:auto;">
                                                    <table class="slds-table slds-table_bordered slds-table_col-bordered" style="width:90%">
                                                        <thead>
                                                            <tr class="slds-text-title_caps">
                                                                <th class="slds-cell-buffer_left slds-cell-buffer_right" style="width:20%">
                                                                    <div class="slds-truncate slds-cell-wrap" title="Projected Value to Approve">Projected Value to Approve</div>
                                                                </th>
                                                                <th class="slds-cell-buffer_left slds-cell-buffer_right" style="width:10%">
                                                                    <div class="slds-truncate" title="Loan To Value">LTV</div>
                                                                </th>
                                                                <th class="slds-cell-buffer_left slds-cell-buffer_right" style="width:20%">
                                                                    <div class="slds-truncate" title="Name">Status</div>
                                                                </th>
                                                                <th class="" style="width:20%">
                                                                    <div class="slds-truncate slds-cell-wrap" title="Date">Approved/Rejected By</div>
                                                                </th>
                                                                <th class="" style="width:15%">
                                                                    <div class="slds-truncate" title="Date">Requested By</div>
                                                                </th>
                                                                <th class="slds-cell-buffer_left slds-cell-buffer_right" style="width:15%">
                                                                    <div class="slds-truncate" title="Date">Date</div>
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <aura:iteration items="{!v.approvalHistory}" var="item" indexVar="i">
                                                                <tr class="slds-hint-parent">     
                                                                    <td class="slds-cell-buffer_left slds-cell-buffer_right" >
                                                                        <lightning:formattedNumber value="{!item.ValueToApprove}" style="currency" />
                                                                    </td>
                                                                    <td class="slds-cell-buffer_left slds-cell-buffer_right" >
                                                                        <lightning:formattedNumber value="{!item.LTV}" style="percent" maximumFractionDigits="2"/>
                                                                    </td>
                                                                    <td class="slds-cell-buffer_left slds-cell-buffer_right" >
                                                                        {!item.Status}
                                                                    </td>
                                                                    <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                                        <aura:if isTrue="{!item.LastActorName != null}">
                                                                            {!item.LastActorName}
                                                                        </aura:if>
                                                                    </td>
                                                                    <td class="slds-cell-buffer_left slds-cell-buffer_right" >
                                                                        {!item.RequestedBy}
                                                                    </td>
                                                                    <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                                        <ui:outputDate aura:id="oDate" value="{!item.CompletedDate}" />
                                                                    </td>
                                                                </tr>
                                                            </aura:iteration>                                    
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </lightning:card>
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </div>
                                <!--
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">Have you ever declared bankruptcy?</span>
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <ui:inputText class="field" value="{!v.oppObj.Have_you_ever_declared_bankruptcy__c}" disabled="true" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                            </lightning:layoutItem>
                        </lightning:layout> 
                        <lightning:layout class="slds-m-left_xx-large">
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large"><span class="slds-form-element__label">If Yes please provide details</span>
                                    <div class="slds-form-element__control">
                                        <span class="">
                                            <ui:inputText class="field" value="{!v.oppObj.Bankruptcy_Details__c}"  disabled="true" />
                                        </span>
                                    </div>
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                            </lightning:layoutItem>
                        </lightning:layout>  -->                      
                            </div>
                        </lightning:card>
                    </div>
                    
                    <!-- <<<<<<<<<< Opportunity Details >>>>>>>>>> -->
                    <!--<div class="slds-col slds-size_1-of-2 "> 
                        <lightning:card title="Opportunity Details" iconName="standard:case" variant="base">                    
                            <div class="slds-card__body_inner">     
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Assigned To</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputText class="field" value="{!v.oppObj.Owner.Name}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                    </lightning:layoutItem>
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Date Applied</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputText class="field" value="{!v.oppObj.Date_Applied__c}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                    </lightning:layoutItem>
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Stage</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputText class="field" value="{!v.oppObj.StageName}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                    </lightning:layoutItem>
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Stage Status</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputText class="field" value="{!v.oppObj.Stage_Status__c}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                    </lightning:layoutItem>
                                </lightning:layout>                         
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Funding Requested</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputCurrency class="field" value="{!v.oppObj.Funding_Requested__c}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                    </lightning:layoutItem>
                                </lightning:layout>                
                            </div>
                        </lightning:card>
                        
                        <lightning:card title="Approved Loan Details" iconName="standard:case" variant="base">                    
                            <div class="slds-card__body_inner">     
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Loan Amount</span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <ui:inputCurrency class="field" value="{!v.oppObj.Amount}" disabled="true" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-left_xx-large">
                                    </lightning:layoutItem>
                                </lightning:layout> 
                            </div>
                        </lightning:card>
                        
                    </div>-->
                </div>
            </lightning:tab>
            
            <!-- <<<<<<< OPPORTUNITY TAB >>>>>>>>> -->
            <lightning:tab id="OPPORTUNITY" label="OPPORTUNITY" onactive="{!c.onfocusOpportunityTab}">
                &nbsp;&nbsp;
                <lightning:button variant="brand" label="New Opportunity" 
                                  title="New Opportunity" onclick="{! c.newOppty }" />
                <br />
                
                <lightning:tabset aura:id="oppTabs" selectedTabId="{!v._selectedSecondaryTabId}" onselect="{!c.onSecondaryTabSelect}" variant="default">
                    
                    <aura:iteration items="{!v.oppList}" var="opp" indexVar="i">                        
                        <lightning:tab id="{!if(opp.Id==null,'NEW',opp.Id)}" label="{!if(opp.Opportunity_Long_Name__c == null,'+ NEW',opp.Opportunity_Long_Name__c) }" onactive="{!c.refreshOptTab}">                            
                            <c:OpportunityViewComponent aura:Id="oppIdx" currentUser="{!v.currentUser}" recordId="{!opp.Id}" accountId="{!v.recordId}"  refreshAllOppties="{!c.refreshOpportunityList}" />
                        </lightning:tab>                        
                    </aura:iteration>
                    <lightning:tab id="NEW" >
                        <aura:set attribute="label">
                            ***NEW***
                            
                            <lightning:icon iconName="action:approval"  />
                        </aura:set>
                        <c:OpportunityViewComponent accountId="{!v.recordId}" refreshAllOppties="{!c.refreshOpportunityList}" />
                    </lightning:tab>
                </lightning:tabset>
            </lightning:tab>
            
            <!-- <<<<<< ACCOUNT NOTES TAB >>>>>>>> -->
            <lightning:tab id="ACCOUNT_NOTES" label="ACCOUNT NOTES" >            
                <lightning:card class="slds-card slds-card_boundary" title="Account Notes" variant="base">
                    <aura:set attribute="actions">
                        <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="New" onclick="{!c.newNote}" />
                        <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Printable Notes View" onclick="{!c.accountNotesPrintView}" />
                    </aura:set>
                    <table class="slds-table slds-table_bordered slds-table_striped slds-table_col-bordered">
                        <thead>
                            <tr class="slds-text-title_caps">
                                <th>
                                    <div class="slds-truncate" title="Column 1">DATE</div>
                                </th>
                                <th>
                                    <div class="slds-truncate" title="Column 1">DETAILED NOTES</div>
                                </th>
                                <th>
                                    <div class="slds-truncate" title="Column 1">Created By</div>
                                </th>
                                <aura:if isTrue="{!v.currentUser.Modify_Notes__c}">
                                    <th style="width:10%">
                                        <div class="slds-truncate" title=""></div>
                                    </th>
                                </aura:if>
                            </tr>
                        </thead>
                        <tbody>
                            <aura:iteration items="{!v.notes}" var="n" indexVar="index">
                                <tr class="slds-hint-parent">
                                    <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                        <ui:outputDateTime  aura:id="startDateFilter" value="{!n.note.CreatedDate}" />
                                    </td>            
                                    <td class="slds-cell-buffer_left slds-cell-buffer_right" style="white-space: pre-wrap;">
                                        <ui:outputRichText value="{!n.body}"/>
                                    </td>  
                                    <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                        <ui:outputText value="{!n.note.CreatedBy.Name}"/>
                                    </td>  
                                    <aura:if isTrue="{!v.currentUser.Modify_Notes__c}">
                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                            <button class="slds-button slds-button_brand" onclick="{!c.editNote}" id="{!n.note.Id}">Edit</button>&nbsp;&nbsp;
                                            <button class="slds-button slds-button_destructive" onclick="{!c.deleteNote}" id="{!n.note.Id}">Del</button>                                        
                                        </td>
                                    </aura:if>
                                </tr>
                            </aura:iteration>
                        </tbody>
                    </table>
                </lightning:card>
                <aura:if isTrue="{!v.showNotePopup==true}" >
                    <div class="slds-m-around--xx-large">
                        <div class="slds-backdrop slds-backdrop--open" aura:id="backGroundSectionId">
                            <div role="dialog" tabindex="-1" aria-labelledby="header99" class="slds-modal slds-fade-in-open ">
                                <div class="slds-modal__container">
                                    <div class="slds-modal__header">
                                        <table width="100%">
                                            <tr>
                                                <td>
                                                    <aura:if isTrue="{!v.selectedNoteId==''}" >
                                                        <h2 id="header99" class="slds-text-heading--medium">New Note</h2>
                                                        <aura:set attribute="else">
                                                            <h2 id="header99" class="slds-text-heading--medium">Update Note</h2>
                                                        </aura:set>
                                                    </aura:if>
                                                    
                                                </td>
                                                <td style="text-align: right" >
                                                    <lightning:icon iconName="action:close" alternativeText="Close" size="xx-small" onclick="{!c.closeNoteModal}" />
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="slds-modal__content slds-p-around--medium">
                                        <!--
                                        <b>Title:</b>
                                        <br/>
                                        <ui:inputText class="form-control" value="{!v.note.Title}"/>
                                        <br/>
                                        <b>Content:</b>
                                        <br/>-->
                                        <lightning:inputRichText value="{!v.noteContent}" placeholder="Type something interesting"/>
                                        <br/>
                                        <div class="slds-modal__footer">
                                            <div class="col-md-4 text-center">
                                                <aura:if isTrue="{!v.selectedNoteId==''}" >
                                                    <ui:button class="btn btn-default" disabled="{!v.createButtonDisabled}" press="{!c.createNote}">Create</ui:button>
                                                    <aura:set attribute="else">
                                                        <ui:button class="btn btn-default" press="{!c.updateNote}">Update</ui:button>
                                                    </aura:set>
                                                </aura:if>
                                                <ui:button class="btn btn-default" press="{!c.closeNoteModal}">Cancel</ui:button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aura:if>
            </lightning:tab>
            
            <!-- <<<<<< LOAN OVERVIEW TAB >>>>>>>> -->
            <lightning:tab id="LOAN_OVERVIEW" label="LOAN OVERVIEW" onactive="{!c.onLoanOverviewTabClick}" >
                <div class="slds-tabs_scoped">
                    <ul class="slds-tabs_scoped__nav" role="tablist">
                        <li class="slds-tabs--scoped__item slds-active customClassForTab" title="Loan Summary" role="presentation" aura:id="loanSummaryId">
                            <a class="slds-tabs_scoped__link" href="javascript:void(0);" onclick="{!c.loanSummaryTab}" role="tab" tabindex="0" aria-selected="true" aria-controls="tab-default-1">
                                Loan Summary
                            </a>
                        </li>
                        <li class="slds-tabs--scoped__item customClassForTab" title="Transactions" role="presentation" aura:id="transactionsId">
                            <a class="slds-tabs_scoped__link" href="javascript:void(0);" onclick="{!c.transactionsTab}" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-default-2">
                                Transactions
                            </a>
                        </li>
                        <aura:if isTrue="{!v.currentUser.Payments_tab__c}">
                            <li class="slds-tabs--scoped__item customClassForTab" title="Payments" role="presentation" aura:id="paymentsId">
                                <a class="slds-tabs_scoped__link" href="javascript:void(0);" onclick="{!c.paymentsTab}" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-default-3">
                                    Payments
                                </a>
                            </li> 
                        </aura:if>
                    </ul>
                    <div id="tab-scoped-1" class="slds-tabs_scoped__content slds-show customClassForTabData" role="tabpanel" aria-labelledby="tab-default-1" aura:id="loanSummaryTabDataId">
                        <!-- <<<<<<<<<< LOAN SUMMARY >>>>>>>>>> -->
                        <lightning:card title="" variant="base">
                            <div class="slds-card__body_inner">
                                <aura:if isTrue="{!!v.currentUser.Loan_Overview_Edit__c}">
                                    <lightning:layout>
                                        <lightning:layoutItem size="12">  
                                            <div class="slds-m-bottom_x-large">
                                                <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_warning" role="alert">
                                                    <span class="slds-assistive-text">warning</span>
                                                    <span class="slds-icon_container slds-icon-utility-warning slds-m-right_x-small" title="Description of icon when needed">
                                                        <lightning:icon iconName="utility:warning" alternativeText="help!" size="xx-small" />
                                                    </span>
                                                    <h2>You don't have permission to generate payouts/balance. Please contact administrator for more information.
                                                    </h2>
                                                </div>   
                                            </div>
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </aura:if>
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                        <h2 class="slds-text-heading--small slds-truncate hd-lbl">Historical Summary</h2>
                                                    </div>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                        <h2 class="slds-text-heading--small slds-truncate hd-lbl">Payout Details</h2>
                                                    </div>                                                    
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Loan Type
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    {!v.LoanSummary.loanType}
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Principal
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <ui:outputCurrency value="{!v.LoanSummary.balancePrincipal}"/>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>
                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Loan Start Date
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    {!v.LoanSummary.loanStartDate}
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Interest
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <ui:outputCurrency value="{!v.LoanSummary.balanceInterest}"/>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout> 
                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Last Payment Date
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    {!v.LoanSummary.lastPaymentDate}
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-top_small">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" style="margin-top:-1%;">
                                            <span class="slds-form-element__label">
                                                Balance
                                            </span>                                            
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <ui:outputCurrency value="{!v.LoanSummary.balance}"/>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>   
                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Max Loan Approved
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <ui:outputCurrency value="{!v.LoanSummary.maxLoanApproved}"/>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <lightning:input class="slds-align_absolute-center" label="Payout Date" 
                                                                     type="date" variant="standard" value="{!v.LoanSummary.payoutDate}" disabled="{!if(v.currentUser.Loan_Overview_Edit__c, false , true)}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Interest Rate
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    {!v.LoanSummary.interestRate}<aura:if isTrue="{!v.LoanSummary.interestRate != null}">%</aura:if>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-top_small">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">Available Credit</span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <ui:outputCurrency value="{!v.LoanSummary.availableCredit}"/>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>   
                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Minimum Interest
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    {!v.LoanSummary.minimumInterest}
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" class="slds-m-top_small">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" style="margin-top:-1%;">
                                            <span class="slds-form-element__label">
                                                Client Rebate
                                            </span>                                            
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <ui:outputCurrency value="{!v.LoanSummary.rebateDiscount}"/>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    
                                </lightning:layout>  
                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Compounding
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    {!v.LoanSummary.compounding}
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <aura:if isTrue="{!v.currentUser.Loan_Overview_Edit__c}">
                                                <lightning:layout horizontalAlign="center" >
                                                    <lightning:layoutItem >
                                                        <lightning:button class="slds-p-around_xx-small slds-theme_neutral slds-align_absolute-center" iconPosition="left" variant="neutral" type="button" label="Email Payout Statement" onclick="{!c.sendPayoutStatement}"></lightning:button>
                                                    </lightning:layoutItem>
                                                    
                                                    <lightning:layoutItem >
                                                        <lightning:button class="slds-p-around_xx-small slds-theme_neutral slds-align_absolute-center" iconPosition="left" variant="neutral" type="button" label="Generate Payout Statement" onclick="{!c.generatePayoutStatement}"></lightning:button>
                                                    </lightning:layoutItem>
                                                    <lightning:layoutItem >
                                                        <lightning:button class="slds-p-around_xx-small slds-theme_neutral" iconPosition="left" 
                                                                          variant="neutral" type="button" label="Generate Payout Balance" onclick="{!c.generatePayout}" />
                                                    </lightning:layoutItem>
                                                </lightning:layout>
                                            </aura:if>
                                        </div>                                         
                                    </lightning:layoutItem>
                                    <!--<lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-grid slds-gutters">
                                              <div class="slds-col slds-size_4-of-12">
                                                <lightning:button class="slds-p-around_xx-small slds-theme_neutral slds-align_absolute-center" iconPosition="left" variant="neutral" type="button" label="Generate Payout Statement" onclick="{!c.generatePayoutStatement}"></lightning:button>  
                                              </div>
                                              <div class="slds-col slds-size_8-of-12">
                                                <lightning:button class="slds-p-around_xx-small slds-theme_neutral" iconPosition="left" 
                                                                                  variant="neutral" type="button" label="Generate Payout Balance" onclick="{!c.generatePayout}" /> 
                                              </div>
                                            </div>
                                        </div>                                         
                                    </lightning:layoutItem>-->
                                </lightning:layout>
                                
                                
                                
                                <lightning:dataTable keyField="Id" data="{!v.LoanSummary.oppsList}" columns="{!v._columns}" hideCheckboxColumn="true" />
                                
                                
                                <lightning:layout>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control">
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <!--<lightning:button class="slds-theme_neutral slds-align_absolute-center" iconPosition="left" 
                                                                      variant="neutral" type="button" label="Generate Payout Balance" onclick="{!c.generatePayout}" /> -->  
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>                                
                                <br/><br/>
                                <div class="slds-form-element slds-align_absolute-center  ">
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            
                                        </span>
                                    </div>
                                </div>
                                <!--<lightning:button class="slds-p-around_xx-small slds-theme_neutral slds-align_absolute-center" iconPosition="left" variant="neutral" type="button" label="Generate Payout Statement" onclick="{!c.generatePayoutStatement}"></lightning:button>-->
                            </div>
                        </lightning:card>
                    </div>
                    
                    
                    <!-- <<<<<<<<<< TRANSACTIONS TABLE >>>>>>>>>> -->
                    <div id="tab-scoped-2" class="slds-tabs_scoped__content slds-hide customClassForTabData" role="tabpanel" aria-labelledby="tab-default-2" aura:id="transactionsTabDataId">
                        
                        <lightning:card class="slds-card slds-card_boundary" title="Transactions" variant="base">
                            <aura:set attribute="actions">
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Export to Excel" onclick="{!c.exportToExcel}" />
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Print Report" onclick="{!c.printReport}" />
                                
                            </aura:set>
                            <div style="overflow: auto; ">
                                <table class="slds-table slds-table_bordered slds-table_striped slds-table_col-bordered">
                                    <thead>
                                        <tr class="slds-text-title_caps">
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Line</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Description</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Opportunity #</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Pymt Date</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Pymt Amount</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Admin Fee</div>
                                            </th>
                                            <!--
											<th>
                                                <div class="slds-truncate" title="Column 1">Total Advanced/Opp</div>
                                            </th>
											-->
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Interest Rate</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">EFT #</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Chq #</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Accrued Interest</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Outstanding Balance</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Per Diem</div>
                                            </th>
                                            <th>
                                                <div class="slds-truncate" title="Column 1">Payout Date as of</div>
                                            </th>                                        
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                        <aura:iteration items="{!v.OpportunityTransactions}" var="opp">
                                            <aura:if isTrue="{!opp.transactions.length > 0}">
                                                <tr>
                                                    <td Colspan="2">
                                                        <lightning:icon iconName="standard:opportunity" size="small" alternativeText="Opportunity" />
                                                        &nbsp;<b>Opportunity Name: {!opp.Name}</b>
                                                    </td>
                                                    <td Colspan="12">
                                                        <b>{!opp.opportunityNumber}</b>
                                                    </td>
                                                    <!--<td Colspan="8">
                                                 <b><ui:outputCurrency aura:id="curr" value="{!opp.advanceSubtotal}" format="$##,##,###,###.00"/></b>
                                                </td>-->
                                                </tr>
                                                <aura:iteration items="{!opp.transactions}" var="item">
                                                    <!--<aura:if isTrue="{!item.paymentMethod != 'Admin Fee'}">-->
                                                    <tr class="slds-hint-parent">
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">{!item.line}</td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right slds-cell-wrap" width="400px;"><a href="{!'/lightning/r/Drawdown__c/'+item.Id+'/view'}">{!item.description}</a></td>
                                                        <!--<td class="slds-cell-buffer_left slds-cell-buffer_right">{!item.opportunityNumber}</td>-->
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right"></td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">{!item.paymentDate}</td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                            <lightning:formattedNumber value="{!item.paymentAmount}" style="currency" />
                                                        </td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                            <lightning:formattedNumber value="{!item.adminFee}" style="currency" />
                                                        </td>
                                                        <!--<td class="slds-cell-buffer_left slds-cell-buffer_right"><ui:outputCurrency value="{!item.totalPerOpportunity}"/></td>-->
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                            {!item.interestRate}
                                                            <aura:if isTrue="{!item.interestRate != null}">%</aura:if>
                                                        </td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">{!item.eft}</td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">{!item.chq}</td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                            <aura:if isTrue="{!item.Payment_Method__c != 'Payment'}">
                                                                <lightning:formattedNumber value="{!item.accruedInterest}" style="currency" />
                                                            </aura:if>
                                                        </td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                            <lightning:formattedNumber value="{!item.outstandingBalance}" style="currency" />
                                                        </td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">
                                                            <lightning:formattedNumber value="{!item.perDiem}" style="currency" />
                                                        </td>
                                                        <td class="slds-cell-buffer_left slds-cell-buffer_right">{!item.payoutDate}</td>
                                                    </tr>
                                                    <!--</aura:if>-->
                                                </aura:iteration>
                                                <tr style="font-style: italic;">
                                                    <td colspan="4">
                                                        <b> Sub-Total:</b>
                                                    </td>
                                                    <td>
                                                        <b><lightning:formattedNumber value="{!opp.paymentAmountSubtotal}" style="currency" /></b>
                                                    </td>
                                                    <td></td>
                                                    <!--<td>
                                                        <b><ui:outputCurrency aura:id="curr" value="{!opp.advanceSubtotal}" format="$##,##,###,###.00"/></b>
                                                    </td>-->
                                                    <td colspan="3" ></td>
                                                    <td>
                                                        <b><lightning:formattedNumber value="{!opp.accruedInterestSubtotal}" style="currency" /></b>
                                                    </td>
                                                    <td>
                                                        <b><lightning:formattedNumber value="{!opp.outstandingBalanceSubtotal}" style="currency" /></b>
                                                    </td>
                                                    <td>
                                                        <b><lightning:formattedNumber value="{!opp.perDiemSubtotal}" style="currency" /></b>
                                                    </td>
                                                    <td></td>
                                                </tr>
                                                
                                            </aura:if>
                                        </aura:iteration>
                                        <tr style="height: 5rem;">
                                            <td colspan="4">
                                                <b> Total:</b>
                                            </td>
                                            <td>
                                                <b><lightning:formattedNumber value="{!v.paymentAmountTotal}" style="currency" /></b>
                                            </td>
                                            <td></td>
                                            <!--<td>
                                                <b><ui:outputCurrency aura:id="curr" value="{!v.advanceTotal}" format="$##,##,###,###.00"/></b>
                                            </td>-->
                                            <td colspan="3" ></td>
                                            <td>
                                                <b><lightning:formattedNumber value="{!v.accruedInterestTotal}" style="currency" /></b>
                                            </td>
                                            <td>
                                                <b><lightning:formattedNumber value="{!v.outstandingBalanceTotal}" style="currency" /> </b>
                                            </td>
                                            <td>
                                                <b><lightning:formattedNumber value="{!v.perDiemTotal}" style="currency" /></b>
                                            </td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </lightning:card>                        
                        
                    </div>
                    
                    <!-- <<<<<<<<<< PAYMENTS >>>>>>>>>> -->
                    <div id="tab-scoped-3" class="slds-tabs_scoped__content slds-hide customClassForTabData" role="tabpanel" aria-labelledby="tab-default-3" aura:id="paymentsTabDataId">                    
                        <lightning:card title="" variant="base">
                            <div class="slds-card__body_inner">
                                <lightning:layout>
                                    <lightning:layoutItem size="4">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                        <lightning:input label="Date of payment" type="date" disabled="{!v.paymentSearchDisabled}" value="{!v.paymentDate}" 
                                                                         min="2010-01-01" max="{! v.calendarMax}" />
                                                    </div>
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                        <lightning:combobox label="Search Type" disabled="{!v.paymentSearchDisabled}" name="SearchType" value="{!v.paymentSearchTypeSelected}" 
                                                                            placeholder="--None--" options="{!v.paymentsSearchTypes}" /> 
                                                    </div>                                                    
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large slds-m-top_large">
                                            <div class="slds-form-element__control">
                                                <span class="slds-form-element__static">
                                                    <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                        <lightning:button class="slds-theme_neutral" disabled="{!v.paymentSearchDisabled}" iconPosition="left" 
                                                                          variant="neutral" type="button" label="Search" onclick="{!c.runAllOptsPayout}" />                    
                                                    </div>                                                    
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout>  
                            </div>
                        </lightning:card>   
                        
                        <hr/>
                        
                        <aura:if isTrue="{!v.paymentSearchTypeSelected == 'Payout' &amp;&amp; v.paymentPayoutSearch || v.paymentSearchTypeSelected == 'Refund' &amp;&amp; v.paymentRefundSearch}">
                            <lightning:layout>
                                <lightning:layoutItem size="4">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <div class="slds-form-element__control">
                                            <span class="slds-form-element__static">
                                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                     <aura:if isTrue="{!v.estimatedTotalBalance != null}">
                                                         Estimated balance after payment: <ui:outputCurrency value="{!v.estimatedTotalBalance}"/>
                                                         <aura:set attribute="else">
                                                         	Total Balance amount <ui:outputCurrency value="{!v.LoanSummary.balance}"/>                                                                    
                                                         </aura:set>
                                                     </aura:if>                                                     
                                                </div>
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <div class="slds-form-element__control">
                                            <span class="slds-form-element__static">
                                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                    <ui:inputCurrency label="Payment Amount" value="{!v.paymentAmount}" keyup="{!c.handlePaymentFieldsChange}" updateOn="keyup"/>
                                                    <div class="slds-grid slds-gutters">                                                        
                                                            <div class="slds-col">
                                                                <div class="slds-form_horizontal">
                                                                	<ui:inputText label="EFT#" value="{!v.EFT}" keyup="{!c.handlePaymentFieldsChange}" updateOn="keyup"/>
                                                                </div>
                                                            </div>
                                                            <div class="slds-col">
                                                                <div class="slds-form_horizontal">
                                                                	<ui:inputText label="CHQ#" value="{!v.CHQ}" keyup="{!c.handlePaymentFieldsChange}" updateOn="keyup"/>
                                                                </div>
                                                            </div>
                                                        
                                                    </div>                                                    
                                                </div>                                                    
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large slds-m-top_large">
                                        <div class="slds-form-element__control">
                                            <span class="slds-form-element__static">
                                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                    <lightning:button class="slds-theme_neutral" iconPosition="left" 
                                                                      variant="neutral" type="button" label="Calculate" onclick="{!c.calculatePayment}"  /> 
                                                    <!--
                                                    <aura:if isTrue="{!v._enableCloseAllPaid}" >    
                                                        <lightning:button class="slds-theme_neutral" iconPosition="left" 
                                                                          variant="brand" type="button" label="Close All Paid" onclick="{!c.closeAllPaidLoans}" />      
                                                    </aura:if>            -->
                                                </div>                                                    
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="2">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large slds-m-top_large">
                                        <div class="slds-form-element__control">
                                            <span class="slds-form-element__static">
                                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                    
                                                </div>                                                    
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>     
                            <hr/>
                            <div class="slds-m-top_xxx-small slds-align_absolute-center">                 
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Submit" onclick="{!c.submitPayments}" />                    
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Cancel" onclick="{!c.cancel}" />                                
                            </div>

                            <aura:if isTrue="{!v.displayPaymentValidationErrors}">                                    
                                <aura:if isTrue="{!v.paymentsError}">
                                    <lightning:layout multipleRows="false">
                                        <lightning:layoutItem class="slds-m-left_medium slds-m-top_medium">
                                            <div style="width:100%;margin-left:2%;">
                                            <div class="slds-notify slds-notify_toast slds-theme_error">                                     
                                                <span class="slds-assistive-text">error</span>
                                                <div class="slds-notify__content">
                                                    <h5 class="slds-text-heading_small slds-align_absolute-center">{!v.paymentsError} </h5>
                            
                                                </div>
                                             </div>
                                            </div>
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </aura:if>
                            </aura:if>
                            <lightning:layout multipleRows="true">
                                <aura:iteration items="{!v.oppList}" var="opp" indexVar="index">
                                    <lightning:layoutItem class="slds-m-left_medium slds-m-top_medium">
                                        <div style="width:500px;margin-left:5%;">
                                            <lightning:card class="slds-card slds-card_boundary" title="{!opp.Loan_Requests__c + ((opp.Stage_Status__c != '' &amp;&amp; opp.Stage_Status__c != '--- None ---') ? ' (' + opp.Stage_Status__c + ')' : '')}" variant="base">
                                                <aura:set attribute="actions">
                                                    <c:PaymentActionsComponent searchType="{!v.paymentSearchTypeSelected}" displayPaymentValidationErrors= "{!v.displayPaymentValidationErrors}" oppId="{!opp.Id}" surplus="{!opp.Surplus__c}" totalPayout="{!opp.Total_Payout__c}" tempPaymentReceived="{!opp.Temp_Payment_Received__c}" stageStatus="{!opp.Stage_Status__c}" stageName="{!opp.StageName}" paymentActionSelected="{!c.handlePaymentActionSelected}" paymentActionValidated="{!c.handlePaymentActionValidated}"/>
                                                         
                                                </aura:set>
                                                <table class="slds-table slds-table_bordered slds-table_striped slds-table_col-bordered">
                                                    <thead>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div title="Column 1">Borrower's Name</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-cell-wrap">
                                                                    {!opp.Account.Name}
                                                                </td>
                                                                <aura:set attribute="else">
                                                                    <td class="slds-cell-wrap slds-text-align_center" rowspan="13">
                                                                        {!opp.Stage_Status__c}
                                                                    </td>                                                                 
                                                                </aura:set>                                                               
                                                            </aura:if>                                                         
                                                        </tr>                                    
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">File #</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    {!opp.Account.AccountNumber}
                                                                </td>                                                               
                                                            </aura:if>                                                            
                                                        </tr>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Principle Sum</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Drawdown_Principal_Total__c}" />       
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>                
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Date of Advance</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    {!opp.Date_of_advance__c}     
                                                                </td>                                                               
                                                            </aura:if>                                                             
                                                        </tr> 
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Date of Payout</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    {!opp.Payout_Date__c}   
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr> 
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Days Outstanding</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    {!opp.Outstanding_Days__c}  
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Accrued Interest</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Drawdown_Total_Interest__c}" />
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Admin Fee</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Drawdown_Admin_Fee_Total__c}" />
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr> 
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Other Fee</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Other_Fee_Roll_Up__c}" />
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>    
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Total Payout</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Total_Payout__c}" />
                                                                </td>                                                               
                                                            </aura:if>
                                                        </tr>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Payment Received</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Temp_Payment_Received__c}" />
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>                                                       
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Shortfall/Surplus</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top slds-border_bottom">
                                                                    <!-- <ui:outputCurrency value="{!opp.Shortfall_Surplus__c}" /> -->
                                                                    <ui:outputCurrency value="{!opp.Surplus__c}" />                                                                    
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>                                                          
                                                        <tr class="slds-text-title_caps">
                                                            <!--
                        <th>	
                                                             <div class="slds-truncate" title="Column 1">Bad Debt</div>
                                                            </th>
                        -->
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Closed - Paid' &amp;&amp; 
                                                                               opp.Stage_Status__c != 'Closed - Surplus' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Shortfall' &amp;&amp;
                                                                               opp.Stage_Status__c != 'Closed - Bad Debt' }">
                                                                <td class="slds-border_top">
                                                                    
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>                                    
                                                    </thead>
                                                </table>
                                            </lightning:card>
                                        </div>
                                    </lightning:layoutItem>
                                </aura:iteration> 
                            </lightning:layout>
                            <div class="slds-m-top_xx-large slds-align_absolute-center">                 
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Submit" onclick="{!c.submitPayments}" />                    
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Cancel" onclick="{!c.cancel}" />
                            </div>

                        </aura:if>
                        
                        
                        <!-- MISC INCOME PAYMENT CHART -->  
                        <aura:if isTrue="{!v.paymentSearchTypeSelected == 'Misc Income Payment' &amp;&amp; v.paymentMiscSearch}">
                            <lightning:layout>
                                <lightning:layoutItem size="3" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <div class="slds-form-element__control slds-m-left_xx-large">
                                            <span class="slds-form-element__static">
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>                               
                                <lightning:layoutItem size="3">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <div class="slds-form-element__control slds-m-left_xx-large">
                                            <span class="slds-form-element__static">
                                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                                    <ui:inputCurrency label="Payment Amount" value="{!v.paymentAmount}" keyup="{!c.handlePaymentFieldsChange}" updateOn="keyup"/>
                                                    <div class="slds-grid slds-gutters">                                                        
                                                            <div class="slds-col">
                                                                <div class="slds-form_horizontal">
                                                                	<ui:inputText label="EFT#" value="{!v.EFT}" keyup="{!c.handlePaymentFieldsChange}" updateOn="keyup"/>
                                                                </div>
                                                            </div>
                                                            <div class="slds-col">
                                                                <div class="slds-form_horizontal">
                                                                	<ui:inputText label="CHQ#" value="{!v.CHQ}" keyup="{!c.handlePaymentFieldsChange}" updateOn="keyup"/>
                                                                </div>
                                                            </div>                                                        
                                                    </div>                                                    
                                                </div>
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-top_large">
                                        <div class="slds-form-element__control">
                                            <span class="slds-form-element__static">
                                                <div class="slds-media__body slds-m-left_xx-small slds-m-bottom_medium">
                                                    <lightning:button class="slds-theme_neutral" iconPosition="left" 
                                                                      variant="neutral" type="button" label="Calculate" onclick="{!c.calculatePayment}"  /> 
                                                </div>                                                    
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>    
                            </lightning:layout> 
                            <hr/>
                            <div class="slds-m-top_xxx-small slds-align_absolute-center">                 
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Submit" onclick="{!c.submitPayments}" />                    
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Cancel" onclick="{!c.cancel}" />
                            </div>

                            <aura:if isTrue="{!v.displayPaymentValidationErrors}">                                    
                                <aura:if isTrue="{!v.paymentsError}">
                                    <lightning:layout multipleRows="false">
                                        <lightning:layoutItem class="slds-m-left_medium slds-m-top_medium">
                                            <div style="width:100%;margin-left:2%;">
                                            <div class="slds-notify slds-notify_toast slds-theme_error">                                     
                                                <span class="slds-assistive-text">error</span>
                                                <div class="slds-notify__content">
                                                    <h5 class="slds-text-heading_small slds-align_absolute-center">{!v.paymentsError} </h5>
                                                    
                                                </div>
                                             </div>
                                            </div>
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </aura:if>
                            </aura:if>
                            <lightning:layout multipleRows="true">
                                <aura:iteration items="{!v.oppList}" var="opp">
                                    <lightning:layoutItem class="slds-m-left_medium slds-m-top_medium">                           
                                        <div style="width:350px;margin-left:5%;">
                                            
                                            <lightning:card class="slds-card slds-card_boundary" title="{!opp.Loan_Requests__c + (opp.Stage_Status__c == 'Bad Debt' ? ' (Bad Debt) ' : '')}" variant="base">
                                                <aura:set attribute="actions">
                                                    <c:PaymentActionsComponent searchType="{!v.paymentSearchTypeSelected}" displayPaymentValidationErrors= "{!v.displayPaymentValidationErrors}" oppId="{!opp.Id}" surplus="{!opp.Surplus__c}" totalPayout="{!opp.Total_Payout__c}" tempPaymentReceived="{!opp.Temp_Payment_Received__c}" stageStatus="{!opp.Stage_Status__c}" stageName="{!opp.StageName}" paymentActionSelected="{!c.handlePaymentActionSelected}" paymentActionValidated="{!c.handlePaymentActionValidated}" />                                                            
                                                </aura:set>
                                                <table class="slds-table slds-table_bordered slds-table_striped slds-table_col-bordered">
                                                    <thead>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Borrower's Name</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Paid Off'}">                                                           
                                                                <td class="slds-cell-wrap">
                                                                    {!opp.Account.Name}
                                                                </td>
                                                                <aura:set attribute="else">
                                                                    <td class="slds-cell-wrap slds-text-align_center" rowspan="5">
                                                                        PAID OFF
                                                                    </td>                                                                 
                                                                </aura:set>                                                                   
                                                            </aura:if>
                                                        </tr>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">File #</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Paid Off'}">
                                                                <td class="slds-border_top">
                                                                    {!opp.Account.AccountNumber}
                                                                </td>
                                                            </aura:if>
                                                        </tr>
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Shortfall/Surplus</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Paid Off'}">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Temp_Payment_Received__c - opp.Total_Payout__c}" />
                                                                </td>                                                               
                                                            </aura:if>                                                           
                                                        </tr>                                                       
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-cell-wrap" title="Column 1">Payment to Misc Income</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Paid Off'}">
                                                                <td class="slds-border_top">
                                                                    <ui:outputCurrency value="{!opp.Temp_Payment_Received__c}" />
                                                                </td>
                                                            </aura:if>
                                                        </tr>   
                                                        <tr class="slds-text-title_caps">
                                                            <th>
                                                                <div class="slds-truncate" title="Column 1">Date of Payment</div>
                                                            </th>
                                                            <aura:if isTrue="{!opp.Stage_Status__c != 'Paid Off'}">                                                           
                                                                <td class="slds-border_top">
                                                                    {!v.paymentDate}
                                                                </td>
                                                            </aura:if>
                                                        </tr>                                    
                                                    </thead>
                                                </table>
                                            </lightning:card>
                                        </div>
                                    </lightning:layoutItem>
                                </aura:iteration>
                            </lightning:layout>
                            <div class="slds-m-top_xx-large slds-align_absolute-center">                 
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Submit" onclick="{!c.submitPayments}" />                    
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Cancel" onclick="{!c.cancel}" />
                            </div>

                        </aura:if>
                    </div>
                    
                </div>       
                
            </lightning:tab>  
            
            <!-- <<<<<<<<<< FINANCING HISTORY TAB  >>>>>>>>> -->
            <lightning:tab id="FINANCING_STATEMENT_HISTORY" label="FINANCING STATEMENT HISTORY">
                <lightning:card title="Amendment(s)" iconName="standard:case" variant="base">                    
                    <div class="slds-card__body_inner">
                        
                        <aura:iteration items="{!v.amendmentList}" var="a">
                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Amendment Details</h2>
                            </div>
                            
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Opportunity
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!a.Opportunity__r.Opportunity_Long_Name__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Registration Date
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!a.Date_Financing_Statement_Done__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Loan Amount
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputCurrency class="field" value="{!a.Amount__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Expiry Date</span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!a.Date_Financing_Statement_Expires__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>  
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">Renewal date</span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!a.Renewal_date__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small"><span class="slds-form-element__label">Renewal Date - New</span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!a.Renewal_Date_New__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>                            
                            <hr/>
                        </aura:iteration>
                    </div>
                </lightning:card>              
                
            </lightning:tab>            
            
            <!-- <<<<<<<<<< FIRM HISTORY TAB  >>>>>>>>> -->
            <lightning:tab id="FIRM_HISTORY" label="FIRM HISTORY" onactive="{!c.onfocusfirmHistoryTab}">
                <lightning:card title="Previous Firm Information" iconName="standard:case" variant="base">                    
                    <div class="slds-card__body_inner">                        
                        <aura:iteration items="{!v.firmHistory}" var="f">
                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Firm Details</h2>
                            </div>
                            
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Law Firm
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!f.Law_Firm__r.Name}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Date of update
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!f.Date_of_Update__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Lawyer
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!f.Lawyer__r.Name}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                </lightning:layoutItem>
                            </lightning:layout>  
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">Phone</span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!f.Phone__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                </lightning:layoutItem>
                            </lightning:layout> 
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">Email</span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!f.Email__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                </lightning:layoutItem>
                            </lightning:layout>                             
                            <hr/>
                        </aura:iteration>
                    </div>
                </lightning:card>
            </lightning:tab>
            
            <!-- <<<<<<<<<< CONTACT HISTORY TAB >>>>>>>>> -->            
            <lightning:tab id="CONTACT_HISTORY" label="CONTACT HISTORY">                
                <lightning:card title="Previous Contact Information" iconName="standard:case" variant="base">                    
                    <div class="slds-card__body_inner">                        
                        <aura:iteration items="{!v.contactsHistory}" var="c">
                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Contact Details</h2>
                            </div>
                            
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Phone
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!c.Phone__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Date of update
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!c.Date_of_update__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Alternate Phone
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!c.Alternate_Phone__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Address
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:outputRichText class="field" value="{!c.Address__c}" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                            </lightning:layout>  
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large" style="margin-top:-25px;">
                                        <span class="slds-form-element__label">Email</span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!c.Email__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                </lightning:layoutItem>
                            </lightning:layout>                            
                            <hr/>
                        </aura:iteration>
                    </div>
                </lightning:card>                 
            </lightning:tab>
            
            
            <!-- <<<<<<<<<< APPLICANT INFORMATION TAB >>>>>>>>> -->
            <lightning:tab id="APPLICANT_INFORMATION" label="APPLICANT INFORMATION" onactive="{!c.onfocusApplicantInfoTab}">
                
                <lightning:card title="Applicant Personal Information" iconName="standard:case" variant="base"> 
                    <aura:set attribute="actions">
                        <div class="slds-button-group" role="group">       
                            <aura:if isTrue="{!v.applicantInfoEditMode == true}">
                                <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Save" onclick="{!c.SaveApplicantInfo}"  />
                                <aura:set attribute="else">
                                    <lightning:button class="slds-theme_neutral" iconPosition="left" variant="neutral" type="button" label="Edit" onclick="{!c.editApplicantInfo}"  />
                                </aura:set>
                            </aura:if>
                            
                        </div> 
                    </aura:set>
                    <aura:if isTrue="{!v.applicantInfoEditMode == false}">
                        <div class="slds-card__body_inner">                        
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            ELF File No.
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.ELF_File_No__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Do you have any dependants
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Do_you_have_any_dependants__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Business Unit
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.accountObj.Business_Unit__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Any SpousalChild support payment
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Any_SpousalChild_support_payment__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Date of Application
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputDate class="field" value="{!v.oppObj.Date_Applied__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            If yes to the above question, please provide amount
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.If_yes_please_provide_amount__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>    
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            DOB
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.DOB__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Have you ever been in arrears on payment
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Have_you_ever_been_in_arrears_on_payment__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>   
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Province
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.MailingState}" disabled="true" /> 
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            Have you ever declared bankruptcy?
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.oppObj.Have_you_ever_declared_bankruptcy__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Citizenship Status
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Citizenship_Status__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            If Yes to the above question, please provide details
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.oppObj.Bankruptcy_Details__c}" disabled="true" />
                                                <!-- <ui:inputText class="field" value="{!v.oppObj.Bankruptcy_Details__c}" disabled="true" /> -->
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Marital Status
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Marital_Status__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">
                                            
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Province of Driver's Licence
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Province_of_Driver_s_Licence__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">                                        
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Driver's Licence No
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Driver_s_Licence_No__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">                                        
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Lawyer Additional Information</h2>
                            </div>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Lawyers Assistant / Paralegal / LC Info
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                 <lightning:textarea class="field" value="{!v.accountObj.Lawyer_s_Assistant_Paralegal_LC_Info__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">   
                                            Date Retained
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">   
                                                <lightning:input type="Date" tabindex="75" class="field" value="{!v.accountObj.Date_Retained__c}" disabled="true" />
                                            </span> 
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Please identify any other lawyer / law firm that has acted for you on your current claim
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.oppObj.Other_Lawyer_Law_Firm_that_acted__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">  
                                            If represented by a Paralegal: Is the settlement going into a Trust Account?
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">  
                                                <lightning:textarea class="field" value="{!v.oppObj.NOTE_For_Paralegals__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Incident / Accident Details</h2>
                            </div>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Date of Accident / Incident
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.oppObj.Date_of_Loss__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            First Party Insurance Company
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.accountObj.First_Party_Insurance_Company__c}" disabled="true" />
                                                <!--<ui:inputText class="field" value="{!v.accountObj.First_Party_Insurance_Company__c}" disabled="true" />-->
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Details of Accident / Incident
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.oppObj.What_Happened_from_W2L__c}" disabled="true" />
                                                <!--<ui:inputText class="field" value="{!v.oppObj.What_Happened_from_W2L__c}" disabled="true" />-->
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Third Party Insurance Company
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.accountObj.Third_Party_Insurance_Company__c}" disabled="true" />
                                                <!--<ui:inputText class="field" value="{!v.accountObj.Third_Party_Insurance_Company__c}" disabled="true" />-->
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Injury
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.oppObj.Nature_of_Injury_from_W2L__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Status of A/B Claim (If settled, how much and when)
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                                
                                                <lightning:textarea class="field" value="{!v.accountObj.Status_of_A_B_Claim_how_much_and_when__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Prior Injury?
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.accountObj.Prior_Injury__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Current Tx
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <lightning:textarea class="field" value="{!v.accountObj.Current_Tx__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Employment Details</h2>
                            </div>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Employment status at time of accident
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Employment_status_at_time_of_accident__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Prior Employment
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <lightning:textarea class="field" value="{!v.conObj.Prior_Employment__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Occupation
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.conObj.Occupation__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Date Last worked? Were attempts made to RTW: Is Job still available?
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <lightning:textarea class="field" value="{!v.conObj.Date_Last_worked_attempts_to_RTW__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Job description
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <lightning:textarea class="field" value="{!v.conObj.Job_description__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Collateral Benefits (If yes, how much?)
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <lightning:textarea class="field" value="{!v.conObj.Collateral_Benefits__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Annual Income on Date of Loss
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.conObj.Annual_Income_on_Date_of_Loss__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Additional Income
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <ui:inputText class="field" value="{!v.conObj.Additional_Income__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>                             
                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Funding Requested</h2>
                            </div>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Existing Litigation Loan?
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.oppObj.Existing_Litigation_Loans__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Funding Requested
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <ui:inputText class="field" value="{!v.oppObj.Funding_Requested__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Loan Amount
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.oppObj.Pre_Existing_Loan_Amount__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <span class="slds-form-element__label">       
                                            Reason for Loan
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <ui:inputText class="field" value="{!v.conObj.Reason_for_Loan__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 
                            <lightning:layout>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                        <span class="slds-form-element__label">
                                            Name of Lender
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">
                                                <ui:inputText class="field" value="{!v.oppObj.Name_of_Lender__c}" disabled="true" />
                                            </span>
                                        </div>
                                    </div>
                                </lightning:layoutItem>
                                <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <!--<span class="slds-form-element__label">       
                                            Address
                                        </span>
                                        <div class="slds-form-element__control">
                                            <span class="">                                            
                                                <ui:inputText class="field" value="{!v.oppObj.Address__c}" disabled="true" />
                                            </span>
                                        </div> -->
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout>              

                            <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                <h2 class="slds-text-heading--small slds-truncate hd-lbl">Additional Details / Info of the file</h2>
                            </div>
                            <lightning:layout>
                                <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                    <div class="slds-form-element slds-m-bottom_small">
                                        <lightning:textarea class="field" value="{!v.accountObj.Additional_Information__c}" disabled="true" />
                                    </div>
                                </lightning:layoutItem>            
                            </lightning:layout> 

                            <c:previousLoanManager oppId="{!v.oppObj.Id}"></c:previousLoanManager>
                        </div>
                        <aura:set attribute="else">
                            <div class="slds-card__body_inner">                        
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                ELF File No.
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Text" tabindex="1" class="field" value="{!v.conObj.ELF_File_No__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">
                                                Do you have any dependants
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.conObj.Do_you_have_any_dependants__c}" 
                                                                        placeholder="--None--" options="{!v.haveAnyDependantsOptions}" tabindex="45" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Business Unit
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox name="BusinessUnit" value="{!v.accountObj.Business_Unit__c}" 
                                                                        placeholder="--None--" options="{! v.businessUnitOptions }" tabindex="5" /> 
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">
                                                Any SpousalChild support payment
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.conObj.Any_SpousalChild_support_payment__c}" 
                                                                        placeholder="--None--" options="{!v.spousalChildSupportPmtOptions}" tabindex="50" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Date of Application
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Date" tabindex="10" class="field" value="{!v.oppObj.Date_Applied__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">
                                                If yes to the above question, please provide amount
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Number" formatter="currency" tabindex="55" class="field" value="{!v.conObj.If_yes_please_provide_amount__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>    
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                DOB
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Date" tabindex="15" class="field" value="{!v.conObj.DOB__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">
                                                Have you ever been in arrears on payment
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.conObj.Have_you_ever_been_in_arrears_on_payment__c}" 
                                                                        placeholder="--None--" options="{!v.howBeenArrearsOnPmtOptions}" tabindex="60" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>   
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Province
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Text" tabindex="20" class="field" value="{!v.conObj.MailingState}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">
                                                Have you ever declared bankruptcy?
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.oppObj.Have_you_ever_declared_bankruptcy__c}" 
                                                                        placeholder="--None--" options="{!v.everDeclaredBankcrupcyOptions}" tabindex="65" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Citizenship Status
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.conObj.Citizenship_Status__c}" 
                                                                        placeholder="--None--" options="{! v.citizenshipStatusOptions }" tabindex="25" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">
                                                If Yes to the above question, please provide details
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:textarea tabindex="70" class="field" value="{!v.oppObj.Bankruptcy_Details__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Marital Status
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.conObj.Marital_Status__c}" 
                                                                        placeholder="--None--" options="{!v.meritalStatusOptions}" tabindex="30" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">
                                                
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Province of Driver's Licence
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Text" tabindex="35" class="field" value="{!v.conObj.Province_of_Driver_s_Licence__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">                                        
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Driver's Licence No
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Text" tabindex="40" class="field" value="{!v.conObj.Driver_s_Licence_No__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">                                        
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 

                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                    <h2 class="slds-text-heading--small slds-truncate hd-lbl">Lawyer Additional Information</h2>
                                </div>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Lawyers Assistant / Paralegal / LC Info
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:textarea class="field" value="{!v.accountObj.Lawyer_s_Assistant_Paralegal_LC_Info__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">   
                                                Date Retained
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">   
                                                    <lightning:input type="Date" tabindex="75" class="field" value="{!v.accountObj.Date_Retained__c}"  />
                                                </span> 
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Please identify any other lawyer / law firm that has acted for you on your current claim
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:textarea class="field" value="{!v.oppObj.Other_Lawyer_Law_Firm_that_acted__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">  
                                                If represented by a Paralegal: Is the settlement going into a Trust Account?
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">  
                                                    <lightning:textarea class="field" value="{!v.oppObj.NOTE_For_Paralegals__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 

                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                    <h2 class="slds-text-heading--small slds-truncate hd-lbl">Incident / Accident Details</h2>
                                </div>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Date of Accident / Incident
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Date" tabindex="75" class="field" value="{!v.oppObj.Date_of_Loss__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                First Party Insurance Company
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="95" class="field" value="{!v.accountObj.First_Party_Insurance_Company__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Details of Accident / Incident
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:textarea tabindex="80" class="field" value="{!v.oppObj.What_Happened_from_W2L__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Third Party Insurance Company
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="100" value="{!v.accountObj.Third_Party_Insurance_Company__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Injury
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Text" tabindex="85" class="field" value="{!v.oppObj.Nature_of_Injury_from_W2L__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Status of A/B Claim (If settled, how much and when)
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="105" class="field" value="{!v.accountObj.Status_of_A_B_Claim_how_much_and_when__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Prior Injury?
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:textarea tabindex="90" class="field" value="{!v.accountObj.Prior_Injury__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Current Tx
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="110" class="field" value="{!v.accountObj.Current_Tx__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 
                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                    <h2 class="slds-text-heading--small slds-truncate hd-lbl">Employment Details</h2>
                                </div>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Employment status at time of accident
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.conObj.Employment_status_at_time_of_accident__c}" 
                                                                        placeholder="--None--" options="{!v.employmentStatusTimeofAccidentOptions}" tabindex="115" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Prior Employment
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="135" class="field" value="{!v.conObj.Prior_Employment__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Occupation
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:textarea tabindex="120" class="field" value="{!v.conObj.Occupation__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Date Last worked? Were attempts made to RTW: Is Job still available?
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="140" class="field" value="{!v.conObj.Date_Last_worked_attempts_to_RTW__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Job description
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:textarea tabindex="125" class="field" value="{!v.conObj.Job_description__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Collateral Benefits (If yes, how much?)
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="145" class="field" value="{!v.conObj.Collateral_Benefits__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Annual Income on Date of Loss
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Number" formatter="currency" tabindex="130" class="field" value="{!v.conObj.Annual_Income_on_Date_of_Loss__c}" step="0.01" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Additional Income
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:input type="Text" tabindex="150" class="field" value="{!v.conObj.Additional_Income__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>                                 
                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                    <h2 class="slds-text-heading--small slds-truncate hd-lbl">Funding Requested</h2>
                                </div>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Existing Litigation Loan?
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:combobox value="{!v.oppObj.Existing_Litigation_Loans__c}" 
                                                                        placeholder="--None--" options="{!v.existingLitigationLoanOptions}" tabindex="155" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Funding Requested
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:input type="Number" formatter="currency" tabindex="170" class="field" value="{!v.oppObj.Funding_Requested__c}" step="0.01" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Loan Amount
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Number" formatter="currency" tabindex="160" class="field" value="{!v.oppObj.Pre_Existing_Loan_Amount__c}" step="0.01" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <span class="slds-form-element__label">       
                                                Reason for Loan
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:input type="Text" tabindex="175" class="field" value="{!v.conObj.Reason_for_Loan__c}"  />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 
                                <lightning:layout>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small slds-m-left_xx-large">
                                            <span class="slds-form-element__label">
                                                Name of Lender
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">
                                                    <lightning:input type="Text" tabindex="165" class="field" value="{!v.oppObj.Name_of_Lender__c}" />
                                                </span>
                                            </div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="4" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <!-- <span class="slds-form-element__label">       
                                                Address
                                            </span>
                                            <div class="slds-form-element__control">
                                                <span class="">                                            
                                                    <lightning:textarea tabindex="180" class="field" value="{!v.oppObj.Address__c}" />
                                                </span>
                                            </div> -->
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout>  

                                <div class="slds-media__body slds-m-left_xx-large slds-m-bottom_medium slds-m-top_x-large">
                                    <h2 class="slds-text-heading--small slds-truncate hd-lbl">Additional Details / Info of the file</h2>
                                </div>
                                <lightning:layout>
                                    <lightning:layoutItem size="8" class="slds-m-left_xx-large">
                                        <div class="slds-form-element slds-m-bottom_small">
                                            <lightning:textarea class="field" value="{!v.accountObj.Additional_Information__c}" />
                                        </div>
                                    </lightning:layoutItem>            
                                </lightning:layout> 

                            </div>
                        </aura:set>
                    </aura:if>
                </lightning:card>
                
            </lightning:tab>


            <!-- <<<<<<<<<< BANK ACCOUNTS TAB >>>>>>>>> -->
            <lightning:tab id="BANK_ACCOUNTS" label="BANK ACCOUNTS">
                
                <lightning:card title="Bank Accounts" iconName="standard:case" variant="base"> 
                    <c:bankAccounts recordId="{!v.recordId}"></c:bankAccounts>
                </lightning:card>
            </lightning:tab>
            
        </lightning:tabset>   
        
        <!-- <<<<<<<<<< SPINNER FOR PROCESSING PURPORSES >>>>>>>>>> -->
        <aura:if isTrue="{!v.spinner}">
            <div class="demo-only demo--inverse" style="height: 6rem;">
                <div class="slds-spinner_container slds-is-fixed">
                    <div role="status" class="slds-spinner slds-spinner_medium">
                        <span class="slds-assistive-text">Loading</span>
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>
                </div>
            </div>
        </aura:if>           
    </body>
</aura:component>